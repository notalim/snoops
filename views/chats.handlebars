<main>
    <div class="chat-container">
        {{#if chats}}
        <div class="all-chats">
            {{#each chats}}
            <div class="chat">
                <p class="uid">User {{this.userId}}</p>
                <p class="acid">User {{this.centerId}}</p>
            </div>
            {{/each}}
        </div>
        <div id="current-chat" class="current-chat">
            
            <input class="textBox" type="text" name="sentMessage" id="sentMessage">
            <button class="button" type="submit">Submit</button>

            {{!-- display chat if clicked on one --}}
        
        </div>
        {{/if}}
    </div>
    <script type="module">
        let chats = document.getElementsByClassName("chat");
        let currentChat = document.getElementById("current-chat");
        for(let chat of chats){
            chat.addEventListener("click", async() =>{
                while(currentChat.childElementCount > 2){
                    currentChat.removeChild(currentChat.lastChild);
                }
                console.log(chat);
                let acid = chat.getElementsByClassName("acid");
                let uid = chat.getElementsByClassName("uid");

                let acidText = acid[0].textContent.split(" ")[1];

                let uidText = uid[0].textContent.split(" ")[1];

                chat.style.color = "red";

                let requestConfig = {
                    method: 'GET',
                    url: `/chats/user/${uidText}/${acidText}`
                };
                (function ($) {
                    $.ajax(requestConfig).then(function (responseMessage){
                        console.log(responseMessage);
                        let messages = responseMessage.messages;
                        for(let message of messages){
                            if(message.senderId === uidText){
                                console.log("User: " + message.messageContent)
                                let messageDiv = document.createElement("div");
                                let messageP = document.createElement("p");
                                messageP.textContent = message.messageContent
                                messageDiv.appendChild(messageP);
                                currentChat.appendChild(messageDiv);
                                messageDiv.classList.add("userMessageDiv");
                                messageP.classList.add("userMessage")
                            }else{
                                console.log("Acenter: " + message.messageContent)
                            }
                        }
                    })
                })(window.jQuery);
            })
        }
        //add the same loading ajax request but on an interval
                console.log(chats[0]);
    </script>
</main>